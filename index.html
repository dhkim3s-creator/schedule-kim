<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>하루 일정</title>
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --text:#111827; --muted:#6b7280; --primary:#4f46e5; --danger:#ef4444; --border:#e5e7eb; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:880px;margin:24px auto;padding:0 16px}
    h1{margin:0 0 12px;font-size:34px;letter-spacing:-0.02em}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.05)}
    .banner{padding:14px 16px;border-bottom:1px solid var(--border);border-radius:16px 16px 0 0;display:none}
    .banner.warn{display:block;background:#fff7ed;border-bottom-color:#fed7aa}
    .banner .title{font-weight:800;color:#9a3412}
    .banner .desc{font-size:13px;color:#9a3412;margin-top:6px;line-height:1.4}
    .top{padding:16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .top .row{display:flex;gap:8px;align-items:center}
    .pill{font-size:12px;color:var(--muted)}
    input[type="date"], input[type="text"]{
      border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px;background:#fff;outline:none
    }
    input[type="text"]{flex:1;min-width:220px}
    button{
      border:0;border-radius:12px;padding:10px 14px;font-weight:700;color:#fff;background:var(--primary);cursor:pointer
    }
    button:disabled{opacity:.45;cursor:not-allowed}
    .btn-secondary{background:#111827}
    .btn-danger{background:var(--danger)}
    .main{padding:0 16px 16px}
    .add{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:8px}
    select{border:1px solid var(--border);border-radius:10px;padding:10px 10px;background:#fff}
    .list{margin-top:14px;display:flex;flex-direction:column;gap:10px}
    .item{display:flex;gap:10px;align-items:center;padding:12px 12px;border:1px solid var(--border);border-radius:14px;background:#fff}
    .item .txt{flex:1}
    .item .time{font-size:12px;color:var(--muted);margin-top:4px}
    .empty{padding:24px;text-align:center;color:var(--muted)}
    .footer-note{margin-top:10px;font-size:12px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    .right{margin-left:auto}
    .checkbox{width:18px;height:18px}
    .strike{text-decoration:line-through;color:#9ca3af}
  </style>
</head>

<body>
  <div class="wrap">
    <h1>하루 일정</h1>

    <div class="card">
      <div id="banner" class="banner warn">
        <div class="title" id="bannerTitle">온라인 동기화가 막혀 있습니다 (로컬로 표시 중)</div>
        <div class="desc" id="bannerDesc"></div>
      </div>

      <div class="top">
        <div class="row">
          <input id="dateInput" type="date" />
          <div class="pill" id="accountPill">계정: -</div>
        </div>
        <div class="right row">
          <button id="retryBtn" class="btn-secondary" style="display:none;">다시 연결</button>
        </div>
      </div>

      <div class="main">
        <div class="add">
          <select id="ampmSel">
            <option value="오전">오전</option>
            <option value="오후">오후</option>
          </select>
          <select id="hourSel"></select>
          <select id="minSel"></select>

          <input id="taskInput" type="text" placeholder="할 일 입력" />
          <button id="addBtn" disabled>추가</button>
        </div>

        <div class="list" id="list"></div>
        <div class="empty" id="empty" style="display:none;">아직 할 일이 없습니다.</div>

        <div class="footer-note">
          ※ GitHub Pages 인증 오류 시 Firebase 콘솔 Authentication → Settings → Authorized domains에
          <b>dhkim3s-creator.github.io</b> 를 추가하세요.
        </div>
      </div>
    </div>

    <div class="small" style="margin-top:10px;">
      저장 위치: (온라인) Firestore /artifacts/schedule-kim-app/users/&lt;uid&gt;/tasks  또는 (오프라인) 브라우저 LocalStorage
    </div>
  </div>

  <!-- Firebase (modular) via CDN -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth,
      signInAnonymously,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    import {
      getFirestore,
      collection,
      addDoc,
      deleteDoc,
      doc,
      updateDoc,
      onSnapshot,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // --- Firebase config (교수님 값) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBSwGAhynYlK68A18WEqWSG1XZaY_q3VHw",
      authDomain: "schedule-kim.firebaseapp.com",
      databaseURL: "https://schedule-kim-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "schedule-kim",
      storageBucket: "schedule-kim.firebasestorage.app",
      messagingSenderId: "623069272138",
      appId: "1:623069272138:web:5caa87bf0723083149aeb3"
    };

    // --- App state ---
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // GitHub Pages에서도 고정되는 appId (문서 경로에 들어감)
    const appId = "schedule-kim-app";

    let user = null;
    let unsubscribeSnap = null;
    let isOffline = false;

    // --- DOM ---
    const banner = document.getElementById("banner");
    const bannerTitle = document.getElementById("bannerTitle");
    const bannerDesc = document.getElementById("bannerDesc");
    const retryBtn = document.getElementById("retryBtn");

    const dateInput = document.getElementById("dateInput");
    const accountPill = document.getElementById("accountPill");

    const ampmSel = document.getElementById("ampmSel");
    const hourSel = document.getElementById("hourSel");
